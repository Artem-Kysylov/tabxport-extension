<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DeepSeek Debug - Market Analysis Dashboard Q4 2024</title>
  <meta name="title" content="Market Analysis Dashboard Q4 2024">
  <meta property="og:title" content="Market Analysis Dashboard Q4 2024 - DeepSeek Chat">
  <meta name="twitter:title" content="Market Analysis Dashboard Q4 2024">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f8fafc;
    }
    
    .debug-info {
      background: #fef3c7;
      border: 2px solid #f59e0b;
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
    }
    
    .debug-info h3 {
      margin: 0 0 10px 0;
      color: #92400e;
    }
    
    .debug-info pre {
      background: #fffbeb;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
    
    .deepseek-interface {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }
    
    /* DeepSeek-like styles */
    .sidebar-chat-item {
      padding: 8px 12px;
      border-radius: 6px;
      margin: 4px 0;
    }
    
    .sidebar-chat-item.active {
      background: #dbeafe;
      border-left: 3px solid #3b82f6;
    }
    
    .chat-title {
      font-weight: 600;
      color: #1e40af;
    }
    
    .conversation-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: #1f2937;
      margin: 10px 0;
    }
    
    .chat-header {
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    
    .user-message {
      background: #f3f4f6;
      padding: 12px;
      border-radius: 8px;
      margin: 10px 0;
      border-left: 4px solid #3b82f6;
    }
    
    .assistant-message {
      background: #f9fafb;
      padding: 12px;
      border-radius: 8px;
      margin: 10px 0;
      border-left: 4px solid #10b981;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      overflow: hidden;
    }
    
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }
    
    th {
      background: #f9fafb;
      font-weight: 600;
    }
    
    .test-button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin: 10px 5px;
    }
    
    .test-button:hover {
      background: #2563eb;
    }
    
    .hidden-elements {
      display: none;
    }
  </style>
</head>
<body>
  <h1>üîç DeepSeek Title Extraction Debug</h1>
  
  <div class="debug-info">
    <h3>üéØ Expected Result</h3>
    <p>Filename should be: <strong>Market_Analysis_Dashboard_Q4_2024_Table_timestamp.xlsx</strong></p>
    <p>Current URL: <span id="current-url"></span></p>
    <p>Detected Source: <span id="detected-source"></span></p>
  </div>
  
  <div class="debug-info">
    <h3>üß™ Test Controls</h3>
    <button class="test-button" onclick="testTitleExtraction()">Test Title Extraction</button>
    <button class="test-button" onclick="showAllElements()">Show All Elements</button>
    <button class="test-button" onclick="simulateDeepSeekURL()">Simulate DeepSeek URL</button>
    <pre id="debug-output"></pre>
  </div>
  
  <!-- Hidden sidebar elements (–∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º DeepSeek) -->
  <div class="hidden-elements">
    <div class="sidebar-chat-item active chat-title">Market Analysis Dashboard Q4 2024</div>
    <div class="chat-list">
      <div class="selected chat-title">Market Analysis Dashboard Q4 2024</div>
      <div class="chat-item">Previous conversation</div>
    </div>
    <div class="chat-sidebar">
      <div class="current">Market Analysis Dashboard Q4 2024</div>
    </div>
    <aside aria-current="page">Market Analysis Dashboard Q4 2024</aside>
    <div class="conversation-item active">Market Analysis Dashboard Q4 2024</div>
    <div data-active="true">Market Analysis Dashboard Q4 2024</div>
  </div>
  
  <!-- Visible DeepSeek interface -->
  <div class="deepseek-interface">
    <div class="chat-header">
      <h1 class="conversation-title">Market Analysis Dashboard Q4 2024</h1>
      <div class="session-title">Market Analysis Dashboard Q4 2024</div>
    </div>
    
    <div class="user-message">
      Can you create a comprehensive market analysis table for Q4 2024?
    </div>
    
    <div class="assistant-message">
      <p>Here's a comprehensive market analysis for Q4 2024:</p>
      
      <table>
        <thead>
          <tr>
            <th>Market Segment</th>
            <th>Revenue (M$)</th>
            <th>Growth %</th>
            <th>Market Share</th>
            <th>Forecast</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Technology</td>
            <td>$1,250</td>
            <td>+15.2%</td>
            <td>28.5%</td>
            <td>Bullish</td>
          </tr>
          <tr>
            <td>Healthcare</td>
            <td>$980</td>
            <td>+8.7%</td>
            <td>22.1%</td>
            <td>Stable</td>
          </tr>
          <tr>
            <td>Finance</td>
            <td>$750</td>
            <td>+5.3%</td>
            <td>17.2%</td>
            <td>Cautious</td>
          </tr>
          <tr>
            <td>Energy</td>
            <td>$620</td>
            <td>-2.1%</td>
            <td>14.1%</td>
            <td>Bearish</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  
  <!-- Additional elements for testing -->
  <div class="hidden-elements">
    <!-- Navigation elements -->
    <nav>
      <a href="#" class="active">Market Analysis Dashboard Q4 2024</a>
      <a href="#">Other Chat</a>
    </nav>
    
    <!-- Menu elements -->
    <div class="menu">
      <div class="chat-item active">Market Analysis Dashboard Q4 2024</div>
    </div>
    
    <!-- Data attributes -->
    <div data-conversation-id="123" data-active="true">Market Analysis Dashboard Q4 2024</div>
    <div data-chat-id="456">Market Analysis Dashboard Q4 2024</div>
  </div>
  
  <script>
    // Simulate DeepSeek environment
    let isDeepSeekSimulated = false;
    
    function simulateDeepSeekURL() {
      // Change URL to simulate DeepSeek
      const newURL = 'https://chat.deepseek.com/chat/market-analysis-q4-2024';
      window.history.pushState({}, '', newURL);
      isDeepSeekSimulated = true;
      
      // Update display
      document.getElementById('current-url').textContent = window.location.href;
      document.getElementById('detected-source').textContent = 'deepseek';
      
      // Set localStorage
      try {
        localStorage.setItem('currentChatTitle', 'Market Analysis Dashboard Q4 2024');
        localStorage.setItem('chatTitle', 'Market Analysis Dashboard Q4 2024');
        sessionStorage.setItem('conversationTitle', 'Market Analysis Dashboard Q4 2024');
      } catch (e) {
        console.log('Cannot set storage:', e);
      }
      
      log('‚úÖ DeepSeek URL simulated: ' + newURL);
      log('‚úÖ localStorage set with title');
    }
    
    function showAllElements() {
      const hiddenElements = document.querySelectorAll('.hidden-elements');
      hiddenElements.forEach(el => {
        el.style.display = 'block';
        el.style.background = '#fef3c7';
        el.style.border = '1px dashed #f59e0b';
        el.style.padding = '10px';
        el.style.margin = '5px 0';
      });
      log('üëÅÔ∏è All hidden elements are now visible');
    }
    
    function log(message) {
      const output = document.getElementById('debug-output');
      const timestamp = new Date().toLocaleTimeString();
      output.textContent += `[${timestamp}] ${message}\n`;
      console.log('DeepSeek Debug:', message);
    }
    
    function testTitleExtraction() {
      log('üîç Starting DeepSeek title extraction test...');
      
      // Test page title
      log(`üìÑ Page title: "${document.title}"`);
      
      // Test meta tags
      const metaTags = ['meta[name="title"]', 'meta[property="og:title"]', 'meta[name="twitter:title"]'];
      metaTags.forEach(selector => {
        const meta = document.querySelector(selector);
        if (meta) {
          log(`üè∑Ô∏è ${selector}: "${meta.getAttribute('content')}"`);
        }
      });
      
      // Test sidebar elements
      const sidebarSelectors = [
        '.sidebar-chat-item.active',
        '.chat-list .selected',
        '.chat-sidebar .current',
        '[class*="sidebar"] [class*="active"]',
        '[class*="chat-list"] [class*="selected"]',
        'aside [aria-current="page"]',
        '.conversation-item.active',
        '[data-active="true"]'
      ];
      
      log('üîç Testing sidebar selectors:');
      sidebarSelectors.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        log(`  ${selector}: found ${elements.length} elements`);
        elements.forEach((el, index) => {
          const text = el.textContent?.trim();
          log(`    [${index}] "${text}"`);
        });
      });
      
      // Test interface elements
      const interfaceSelectors = [
        '.chat-title',
        '.conversation-title',
        '.session-title',
        '[class*="chat-title"]',
        '[class*="conversation-title"]',
        '[class*="session-title"]',
        'header .title',
        '.chat-header h1',
        '.chat-header h2'
      ];
      
      log('üîç Testing interface selectors:');
      interfaceSelectors.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        log(`  ${selector}: found ${elements.length} elements`);
        elements.forEach((el, index) => {
          const text = el.textContent?.trim();
          log(`    [${index}] "${text}"`);
        });
      });
      
      // Test navigation elements
      const navSelectors = [
        '[class*="sidebar"] a',
        '[class*="nav"] a',
        '[class*="menu"] a',
        '.chat-item',
        '.conversation-item',
        '.session-item',
        '[data-conversation-id]',
        '[data-chat-id]'
      ];
      
      log('üîç Testing navigation selectors:');
      navSelectors.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        log(`  ${selector}: found ${elements.length} elements`);
        elements.forEach((el, index) => {
          const text = el.textContent?.trim();
          const isActive = el.classList.contains('active') ||
                          el.classList.contains('selected') ||
                          el.classList.contains('current') ||
                          el.getAttribute('aria-current') === 'page' ||
                          el.getAttribute('data-active') === 'true';
          log(`    [${index}] "${text}" (active: ${isActive})`);
        });
      });
      
      // Test user messages
      const userSelectors = [
        '.user-message:first-child',
        '.human-message:first-child',
        '[class*="user-message"]:first-child',
        '[class*="human-message"]:first-child',
        '[role="user"]:first-child',
        '.message.user:first-child',
        '.msg-user:first-child'
      ];
      
      log('üîç Testing user message selectors:');
      userSelectors.forEach(selector => {
        const element = document.querySelector(selector);
        if (element) {
          const text = element.textContent?.trim();
          log(`  ${selector}: "${text?.substring(0, 50)}..."`);
        } else {
          log(`  ${selector}: not found`);
        }
      });
      
      // Test localStorage
      log('üîç Testing localStorage:');
      const storageKeys = ['currentChatTitle', 'chatTitle', 'conversationTitle', 'sessionTitle'];
      storageKeys.forEach(key => {
        try {
          const value = localStorage.getItem(key) || sessionStorage.getItem(key);
          log(`  ${key}: "${value}"`);
        } catch (e) {
          log(`  ${key}: error accessing storage`);
        }
      });
      
      // Test URL
      log(`üîç Current URL: ${window.location.href}`);
      log(`üîç URL includes deepseek: ${window.location.href.includes('deepseek')}`);
      
      log('‚úÖ Title extraction test completed');
    }
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('current-url').textContent = window.location.href;
      document.getElementById('detected-source').textContent = window.location.href.includes('deepseek') ? 'deepseek' : 'other';
      
      // Auto-simulate DeepSeek if not already
      if (!window.location.href.includes('deepseek')) {
        setTimeout(simulateDeepSeekURL, 1000);
      }
      
      log('üöÄ DeepSeek debug page loaded');
      log('üìã Use the test buttons to debug title extraction');
    });
  </script>
</body>
</html> 