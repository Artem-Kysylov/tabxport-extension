# Google Sheets Export Feature Implementation Plan

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ç–∞–±–ª–∏—Ü –≤ –Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç Google Sheets –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –≠—Ç–∞ —Ñ–∏—á–∞ –¥–∞—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å Google Spreadsheets –Ω–∞–ø—Ä—è–º—É—é, —á—Ç–æ —É–ª—É—á—à–∏—Ç —Å–æ–≤–º–µ—Å—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Google —ç–∫–æ—Å–∏—Å—Ç–µ–º–æ–π.

## üí° –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

- **–£—Å–ª–æ–≤–Ω–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**: Google Sheets —Ñ–æ—Ä–º–∞—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Google Drive
- **UI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ popup –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∏ batch export modal
- **API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Google Sheets API v4 –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è spreadsheets
- **Batch –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ sheets –≤ –æ–¥–Ω–æ–º spreadsheet

## üìã –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –∑–∞–¥–∞—á

### **–ó–∞–¥–∞—á–∞ 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ OAuth –∏ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞** üîê
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Google Sheets API
**–î–µ–π—Å—Ç–≤–∏—è**:
- –î–æ–±–∞–≤–∏—Ç—å `https://www.googleapis.com/auth/spreadsheets` –≤ OAuth scopes
- –û–±–Ω–æ–≤–∏—Ç—å `src/lib/supabase-google-auth.ts` —Å –Ω–æ–≤—ã–º scope
- –û–±–Ω–æ–≤–∏—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç —Å –Ω–æ–≤—ã–º–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ API
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤—ã–º–∏ scopes
**–§–∞–π–ª—ã**: `src/lib/supabase-google-auth.ts`, `src/manifest.json`

### **–ó–∞–¥–∞—á–∞ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ —Ñ–æ—Ä–º–∞—Ç–∞** üìä
**–°—Ç–∞—Ç—É—Å**: –ù–µ –Ω–∞—á–∞—Ç–∞
**–û–ø–∏—Å–∞–Ω–∏–µ**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–∏–ø–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Google Sheets
**–î–µ–π—Å—Ç–≤–∏—è**:
- –î–æ–±–∞–≤–∏—Ç—å `"google_sheets"` –≤ `ExportFormat` type
- –û–±–Ω–æ–≤–∏—Ç—å `EXPORT_FORMATS` –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ Google Sheets
- –î–æ–±–∞–≤–∏—Ç—å –∏–∫–æ–Ω–∫—É, –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `supportsCombined: true` –¥–ª—è batch export
**–§–∞–π–ª—ã**: `src/contents/components/batch-export/types.ts`

### **–ó–∞–¥–∞—á–∞ 3: –°–æ–∑–¥–∞–Ω–∏–µ Google Sheets API —Å–µ—Ä–≤–∏—Å–∞** ‚öôÔ∏è
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞
**–û–ø–∏—Å–∞–Ω–∏–µ**: –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Google Sheets API
**–î–µ–π—Å—Ç–≤–∏—è**:
- ‚úÖ –°–æ–∑–¥–∞—Ç—å `src/lib/google-sheets-api.ts`
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã:
  - `createSpreadsheet(title: string)` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ spreadsheet
  - `addSheetData(spreadsheetId: string, data: TableData)` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  - `formatSheet(spreadsheetId: string, sheetId: number)` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä `tableDataToSheetsFormat()`
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ spreadsheet

### **–ó–∞–¥–∞—á–∞ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –≤ popup –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö** üé®
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞
**–û–ø–∏—Å–∞–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Google Sheets –∫–Ω–æ–ø–∫–∏ –≤ —Ñ–æ—Ä–º—É –Ω–∞—Å—Ç—Ä–æ–µ–∫
**–î–µ–π—Å—Ç–≤–∏—è**:
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `src/components/SettingsForm.tsx`
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "üìä Google Sheets" –≤ grid —Ñ–æ—Ä–º–∞—Ç–æ–≤
- ‚úÖ –°–¥–µ–ª–∞—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ–π –æ—Ç `isGoogleDriveAuthenticated`
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∏–ª–∏ –∏ –∏–Ω–¥–∏–∫–∞—Ü–∏—é "‚òÅÔ∏è Cloud Native"
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞
**–§–∞–π–ª—ã**: `src/components/SettingsForm.tsx`

### **–ó–∞–¥–∞—á–∞ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ batch export modal** üì¶
**–°—Ç–∞—Ç—É—Å**: –ù–µ –Ω–∞—á–∞—Ç–∞
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Google Sheets –≤ modal —ç–∫—Å–ø–æ—Ä—Ç–∞
**–î–µ–π—Å—Ç–≤–∏—è**:
- –û–±–Ω–æ–≤–∏—Ç—å `createFormatSelector()` –≤ `html-generators.ts`
- –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É –ø–æ–∫–∞–∑–∞ Google Sheets
- –û–±–Ω–æ–≤–∏—Ç—å event handlers –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–±–æ—Ä Google Sheets –≤ modal
**–§–∞–π–ª—ã**: `src/contents/components/batch-export/html-generators.ts`

### **–ó–∞–¥–∞—á–∞ 6: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è single table —ç–∫—Å–ø–æ—Ä—Ç–∞** üîÑ
**–°—Ç–∞—Ç—É—Å**: –ù–µ –Ω–∞—á–∞—Ç–∞
**–û–ø–∏—Å–∞–Ω–∏–µ**: –û—Å–Ω–æ–≤–Ω–æ–π export flow –¥–ª—è –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
**–î–µ–π—Å—Ç–≤–∏—è**:
- –û–±–Ω–æ–≤–∏—Ç—å `src/lib/export.ts` —Å Google Sheets —ç–∫—Å–ø–æ—Ä—Ç–æ–º
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Google Sheets API –≤ export flow
- –û–±–Ω–æ–≤–∏—Ç—å `export-button.ts` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
- –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ success —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ Google Sheets

### **–ó–∞–¥–∞—á–∞ 7: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è batch —ç–∫—Å–ø–æ—Ä—Ç–∞** üìä
**–°—Ç–∞—Ç—É—Å**: –ù–µ –Ω–∞—á–∞—Ç–∞
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç —Ç–∞–±–ª–∏—Ü –≤ –æ–¥–∏–Ω Google Spreadsheet
**–î–µ–π—Å—Ç–≤–∏—è**:
- –û–±–Ω–æ–≤–∏—Ç—å batch export handlers –≤ `modal-handlers.ts`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ multiple sheets –≤ –æ–¥–Ω–æ–º spreadsheet
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–Ω–¥–∏–∫–∞—Ü–∏—é –¥–ª—è Google Sheets –æ–ø–µ—Ä–∞—Ü–∏–π
- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ sheets (Table 1, Table 2, –∏–ª–∏ custom names)
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å batch —ç–∫—Å–ø–æ—Ä—Ç –≤ Google Sheets

### **–ó–∞–¥–∞—á–∞ 8: –£–ª—É—á—à–µ–Ω–∏–µ UX –∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è** ‚ú®
**–°—Ç–∞—Ç—É—Å**: –ù–µ –Ω–∞—á–∞—Ç–∞
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞
**–î–µ–π—Å—Ç–≤–∏—è**:
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ Google Sheets
- –£–ª—É—á—à–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –∫–Ω–æ–ø–∫–æ–π "Open in Google Sheets"
- –î–æ–±–∞–≤–∏—Ç—å fallback –ª–æ–≥–∏–∫—É –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Sheets API
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å sharing permissions –¥–ª—è —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö sheets
- –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### **–ó–∞–¥–∞—á–∞ 9: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –¥–µ–ø–ª–æ–π** üìö
**–°—Ç–∞—Ç—É—Å**: –ù–µ –Ω–∞—á–∞—Ç–∞
**–û–ø–∏—Å–∞–Ω–∏–µ**: –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
**–î–µ–π—Å—Ç–≤–∏—è**:
- –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ Google Sheets —ç–∫—Å–ø–æ—Ä—Ç—É
- –û–±–Ω–æ–≤–∏—Ç—å README —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –Ω–æ–≤–æ–π —Ñ–∏—á–∏
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –°–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ release notes

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### API Endpoints
- **Google Sheets API v4**: `https://sheets.googleapis.com/v4/spreadsheets`
- **–°–æ–∑–¥–∞–Ω–∏–µ spreadsheet**: `POST /spreadsheets`
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: `PUT /spreadsheets/{spreadsheetId}/values/{range}`

### OAuth Scopes
```javascript
export const GOOGLE_DRIVE_SCOPES = [
  "https://www.googleapis.com/auth/userinfo.email",
  "https://www.googleapis.com/auth/userinfo.profile", 
  "https://www.googleapis.com/auth/drive.file",
  "https://www.googleapis.com/auth/spreadsheets" // NEW
]
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
```typescript
interface SheetsExportResult {
  success: boolean
  spreadsheetId?: string
  spreadsheetUrl?: string
  error?: string
}
```

## üéØ Success Criteria

1. ‚úÖ Google Sheets —Ñ–æ—Ä–º–∞—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
2. ‚úÖ Single table —ç–∫—Å–ø–æ—Ä—Ç —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π Google Spreadsheet
3. ‚úÖ Batch export —Å–æ–∑–¥–∞–µ—Ç multiple sheets –≤ –æ–¥–Ω–æ–º spreadsheet  
4. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã–π sheet
5. ‚úÖ Proper error handling –∏ fallback logic
6. ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º export flow

## üìù –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

**–ó–∞–¥–∞—á–∞ 1**: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞ - OAuth –∏ –º–∞–Ω–∏—Ñ–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã
**–ó–∞–¥–∞—á–∞ 2**: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞ - –ù–æ–≤—ã–π —Ç–∏–ø —Ñ–æ—Ä–º–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω
**–ó–∞–¥–∞—á–∞ 3**: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞ - Google Sheets API —Å–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞–Ω
**–ó–∞–¥–∞—á–∞ 4**: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞ - UI popup –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ó–∞–¥–∞—á–∞ 5 - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ batch export modal
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π**: AI Assistant + User
**Timeline**: –ü–æ—à–∞–≥–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –∑–∞ —Ä–∞–∑

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ Google Sheets —ç–∫—Å–ø–æ—Ä—Ç–æ–º –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç. 