<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Market Analysis Dashboard Q4 2024</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .debug-panel {
      background: #e3f2fd;
      border: 1px solid #2196f3;
      border-radius: 4px;
      padding: 15px;
      margin: 20px 0;
    }
    
    .debug-panel h3 {
      margin: 0 0 10px 0;
      color: #1976d2;
    }
    
    .test-button {
      background: #2196f3;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    
    .test-button:hover {
      background: #1976d2;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }
    
    th {
      background: #f5f5f5;
      font-weight: bold;
    }
    
    .log-output {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Market Analysis Dashboard Q4 2024</h1>
    
    <div class="debug-panel">
      <h3>🔧 DeepSeek Title Extraction Test</h3>
      <p><strong>Expected filename:</strong> Market_Analysis_Dashboard_Q4_2024_Table_timestamp.xlsx</p>
      <p><strong>Current URL:</strong> <span id="current-url"></span></p>
      
      <button class="test-button" onclick="simulateDeepSeek()">Simulate DeepSeek URL</button>
      <button class="test-button" onclick="testExtraction()">Test Title Extraction</button>
      <button class="test-button" onclick="clearLog()">Clear Log</button>
      
      <div id="log-output" class="log-output"></div>
    </div>
    
    <!-- Простая таблица для тестирования экспорта -->
    <h2>Q4 2024 Market Data</h2>
    <table>
      <thead>
        <tr>
          <th>Sector</th>
          <th>Revenue (M$)</th>
          <th>Growth %</th>
          <th>Market Share</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Technology</td>
          <td>$1,250</td>
          <td>+15.2%</td>
          <td>28.5%</td>
        </tr>
        <tr>
          <td>Healthcare</td>
          <td>$980</td>
          <td>+8.7%</td>
          <td>22.1%</td>
        </tr>
        <tr>
          <td>Finance</td>
          <td>$750</td>
          <td>+5.3%</td>
          <td>17.2%</td>
        </tr>
      </tbody>
    </table>
    
    <!-- Скрытые элементы для тестирования -->
    <div style="display: none;">
      <div class="conversation-title">Market Analysis Dashboard Q4 2024</div>
      <div class="chat-title">Market Analysis Dashboard Q4 2024</div>
      <h1>Market Analysis Dashboard Q4 2024</h1>
      <div class="sidebar-chat-item active">Market Analysis Dashboard Q4 2024</div>
    </div>
  </div>
  
  <script>
    function log(message) {
      const output = document.getElementById('log-output');
      const timestamp = new Date().toLocaleTimeString();
      output.textContent += `[${timestamp}] ${message}\n`;
      output.scrollTop = output.scrollHeight;
      console.log('Test:', message);
    }
    
    function clearLog() {
      document.getElementById('log-output').textContent = '';
    }
    
    function simulateDeepSeek() {
      // Изменяем URL для имитации DeepSeek
      const newURL = 'https://chat.deepseek.com/chat/market-analysis-q4-2024';
      window.history.pushState({}, '', newURL);
      document.getElementById('current-url').textContent = newURL;
      
      // Устанавливаем localStorage
      try {
        localStorage.setItem('currentChatTitle', 'Market Analysis Dashboard Q4 2024');
        localStorage.setItem('chatTitle', 'Market Analysis Dashboard Q4 2024');
        log('✅ DeepSeek URL simulated: ' + newURL);
        log('✅ localStorage set with title');
      } catch (e) {
        log('❌ Error setting localStorage: ' + e.message);
      }
    }
    
    function testExtraction() {
      log('🔍 Starting title extraction test...');
      
      // Проверяем URL
      const currentURL = window.location.href;
      log('📍 Current URL: ' + currentURL);
      log('🔍 URL includes deepseek: ' + currentURL.includes('deepseek'));
      
      // Проверяем заголовок страницы
      log('📄 Page title: "' + document.title + '"');
      
      // Проверяем localStorage
      try {
        const stored = localStorage.getItem('currentChatTitle');
        log('💾 localStorage currentChatTitle: "' + stored + '"');
      } catch (e) {
        log('❌ Error accessing localStorage: ' + e.message);
      }
      
      // Проверяем видимые элементы
      const selectors = [
        '.conversation-title',
        '.chat-title',
        'h1',
        'h2'
      ];
      
      selectors.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        log(`🔍 Selector "${selector}": found ${elements.length} elements`);
        elements.forEach((el, index) => {
          const text = el.textContent?.trim();
          log(`  [${index}] "${text}"`);
        });
      });
      
      // Проверяем скрытые элементы
      log('👁️ Testing hidden elements...');
      const hiddenElements = document.querySelectorAll('[style*="display: none"] *');
      hiddenElements.forEach((el, index) => {
        const text = el.textContent?.trim();
        if (text && text.length > 5) {
          log(`  Hidden[${index}] ${el.className || el.tagName}: "${text}"`);
        }
      });
      
      log('✅ Test completed');
    }
    
    // Инициализация
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('current-url').textContent = window.location.href;
      log('🚀 Test page loaded');
      
      // Автоматически симулируем DeepSeek через 1 секунду
      setTimeout(() => {
        if (!window.location.href.includes('deepseek')) {
          simulateDeepSeek();
        }
      }, 1000);
    });
  </script>
</body>
</html> 