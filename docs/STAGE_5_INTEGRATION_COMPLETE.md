# ‚úÖ Stage 5: Integration Complete - Table Merger Feature

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: $(date)  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω  
**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø**: Stage 6 - Error Handling  

---

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 5.1 Modify modal-handlers.ts for new checkbox
**–°—Ç–∞—Ç—É—Å**: –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–ò–∑–º–µ–Ω–µ–Ω–∏—è**: 
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `mergeSimilarColumns: modalState.config.mergeSimilarColumns` –≤ `exportOptions`
- –≠–∫—Å–ø–æ—Ä—Ç options —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞–µ—Ç —Ñ–ª–∞–≥ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –≤ `exportService.combineTables()`

### ‚úÖ 5.2 Update combined-exporter.ts for merge support  
**–°—Ç–∞—Ç—É—Å**: –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç table merger —Å–µ—Ä–≤–∏—Å–∞ –≤ `ExportService`
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏: `convertToMergerFormat()` –∏ `convertFromMergerFormat()`
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ `options.mergeSimilarColumns` –≤ `combineTables()`
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω fallback –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### ‚úÖ 5.3 Integrate with existing analytics system
**–°—Ç–∞—Ç—É—Å**: –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- Analytics –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `tablesToProcess` (merged –∏–ª–∏ original)
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –≤—Å–µ —Ç–∏–ø—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (sum, average, count)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### ‚úÖ 5.4 Ensure compatibility with all export formats
**–°—Ç–∞—Ç—É—Å**: –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- Merge —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ –≤—Å–µ–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏: XLSX, CSV, PDF, DOCX, Google Sheets
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Ç–æ—Ç –∂–µ pipeline –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- –ù–∏–∫–∞–∫–∏—Ö —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ format-specific exporters –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

### ‚úÖ 5.5 Add logic for merged vs original table selection
**–°—Ç–∞—Ç—É—Å**: –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –£–º–Ω–∞—è –ª–æ–≥–∏–∫–∞: –µ—Å–ª–∏ merge –≤–∫–ª—é—á–µ–Ω –∏ ‚â•2 —Ç–∞–±–ª–∏—Ü ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è merge
- –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º merge: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞  
- –ü—Ä–∏ –æ—à–∏–±–∫–µ merge: fallback –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
```
UI Modal (checkbox) 
    ‚Üì 
modal-handlers.ts (–ø–µ—Ä–µ–¥–∞—á–∞ —Ñ–ª–∞–≥–∞)
    ‚Üì 
ExportService.combineTables() (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞)
    ‚Üì 
Table Merger Service (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ)
    ‚Üì 
Analytics Service (–æ–±—Ä–∞–±–æ—Ç–∫–∞)
    ‚Üì 
Format-specific exporters (–≤—ã–≤–æ–¥)
```

### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `convertToMergerFormat()` - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ `TableData[]` –≤ merger —Ñ–æ—Ä–º–∞—Ç
- `convertFromMergerFormat()` - –æ–±—Ä–∞—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- Smart fallback –ª–æ–≥–∏–∫–∞ –≤ `try/catch` –±–ª–æ–∫–∞—Ö
- Threshold = 0.75 –¥–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤
- ‚úÖ `src/types/index.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `mergeSimilarColumns?: boolean`
- ‚úÖ `src/services/export/index.ts` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è table merger
- ‚úÖ `src/contents/components/batch-export/modal-handlers.ts` - –ø–µ—Ä–µ–¥–∞—á–∞ –æ–ø—Ü–∏–π
- ‚úÖ `scripts/test-table-merger.js` - —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–ø–∏–ª—è—Ü–∏—è
- ‚úÖ TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ `npm run build:chrome-dev` —É—Å–ø–µ—à–µ–Ω
- ‚úÖ –í—Å–µ —Ç–∏–ø—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é)
- ‚è≥ UI checkbox –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ ‚â•2 —Ç–∞–±–ª–∏—Ü–∞—Ö
- ‚è≥ Merge –∞–ª–≥–æ—Ä–∏—Ç–º –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –ø–æ—Ö–æ–∂–∏–µ —Å—Ç–æ–ª–±—Ü—ã  
- ‚è≥ Analytics –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
- ‚è≥ Fallback —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö merge

---

## üéØ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Stage 6

**–ß—Ç–æ –≥–æ—Ç–æ–≤–æ**:
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è UI ‚Üí Backend
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π  
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —ç–∫—Å–ø–æ—Ä—Ç–∞
- ‚úÖ –£–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ fallback

**–ß—Ç–æ —Å–ª–µ–¥—É–µ—Ç**:
- üîú **Stage 6**: Error Handling & Edge Cases
- üîú **Stage 7**: Testing & Quality Assurance

---

## üíª –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –°–±–æ—Ä–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
npm run build:chrome-dev

# –ó–∞–≥—Ä—É–∑–∫–∞ extension –≤ Chrome
# chrome://extensions/ ‚Üí Load unpacked ‚Üí build/chrome-mv3-dev

# –¢–µ—Å—Ç script –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
# F12 ‚Üí Console ‚Üí copy-paste scripts/test-table-merger.js
```

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: Stage 5 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω. Table Merger –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º—É —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º. 